---
title: "Wonder oREV link"
output: html_document
date: "2023-02-25"
---

```{r setup, include=FALSE}
library(tidyverse)
library(ggpubr)
library(tidyboot)
library(brms)
library(ggthemes)
library(geomtextpath)
```

# new Data

```{r}

wonder_data <- read_csv("../data/wonder_data.csv")
orev_data <- read_csv("../data/orev_data.csv")

link_data <- wonder_data%>%
  group_by(age, subjID)%>%
  summarise(wonder = mean(score))%>%
  left_join(orev_data%>%
              group_by(subjID)%>%
              summarise(orev = mean(correct)))%>%
  filter(!is.na(orev))%>%
  mutate(age_group = substr(age, 1,1))%>%
  ungroup()%>%
  distinct(subjID, .keep_all = T)

link_data_select <- wonder_data%>%
  filter(english %in% orev_data$targetWord)%>%
  group_by(age, subjID)%>%
  summarise(wonder = sum(score))%>%
  left_join(orev_data%>%
              group_by(subjID)%>%
              summarise(orev = sum(correct)))%>%
  mutate(age_group = substr(age, 1,1))%>%
  filter(!is.na(orev))%>%
  ungroup()%>%
  distinct(subjID, .keep_all = T)

```

```{r}
ggplot(link_data, aes(x = wonder, y = orev))+
  geom_abline(intercept = 0, slope = 1, lty = 3, alpha = .5)+
  geom_point(pch = 1, alpha = .5)+
  stat_cor()+
  #facet_grid(~age_group)+
  lims(x = c(0,1), y = c(0,1))+
  theme_bw()
```
```{r}
ppcor::pcor.test(link_data$wonder, link_data$orev, link_data$age)
```


```{r}
ggplot(link_data_select, aes(x = wonder, y = orev))+
  geom_abline(intercept = 0, slope = 1, lty = 3, alpha = .5)+
  geom_point(pch = 1, alpha = .5)+
  stat_cor()+
  #facet_grid(~age_group)+
  lims(x = c(0,22), y = c(0,22))+
  theme_bw()
```

```{r}
m_won_orev <- wonder_data%>%
  group_by(subjID)%>%
  group_by(age, subjID)%>%
  summarise(sum  = sum(score),
            n = n())%>%
  left_join(orev_data%>%
              group_by(subjID)%>%
              summarise(orev = sum(correct)))%>%
  filter(!is.na(orev))%>%
  ungroup()%>%
  mutate(age = scale(age),
         orev = scale(orev))
  

m1 <- brm(sum |trials(n) ~ age + orev, family = binomial, data = m_won_orev, chains = 4, cores = 4)
```


# old Data

```{r}
orev_d <- read_csv("../../vocab/data/clean_data.csv")%>%
  filter(targetWord %in% readRDS("../../vocab/saves/selected_items_rasch.rds"))%>%
  group_by(subjID)%>%
  summarise(orev = mean(correct))

wonder_d <- wonder_data%>%
  group_by(age, subjID)%>%
  summarise(wonder = mean(score))

wonder_d%>%
  left_join(orev_d)%>%
  filter(!is.na(orev))%>%
  ggplot(aes(x = wonder, y = orev))+
  geom_abline(intercept = 0, slope = 1, lty = 3, alpha = .5)+
  geom_point(pch = 1, alpha = .5)+
  stat_cor()+
  lims(x = c(0,1), y = c(0,1))+
  theme_bw()

orev_wonder <- wonder_d%>%
  left_join(orev_d)%>%
  filter(!is.na(orev))%>%
  distinct(subjID, .keep_all = T)

ppcor::pcor.test(orev_wonder$wonder, orev_wonder$orev, orev_wonder$age)

om_won_orev <- wonder_data%>%
  group_by(age, subjID)%>%
  summarise(sum  = sum(score),
            n = n())%>%
  left_join(orev_d)%>%
  filter(!is.na(orev))%>%
  ungroup()%>%
  mutate(age = scale(age),
         orev = scale(orev))
  

om1 <- brm(sum |trials(n) ~ age + orev, family = binomial, data = om_won_orev, chains = 4, cores = 4)
```